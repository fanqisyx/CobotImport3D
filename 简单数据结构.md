### 核心几何与基础类型

这些是构建更复杂数据结构的基础。

1. **`Vector3D` (结构体)**：表示三维空间中的点或向量。
   
   C#
   
   ```
   public struct Vector3D
   {
      public double X { get; set; }
      public double Y { get; set; }
      public double Z { get; set; }
   
      public Vector3D(double x, double y, double z)
      {
          X = x;
          Y = y;
          Z = z;
      }
      // 可以添加常见的向量运算，例如加法、减法、点积、叉积、长度等
   }
   ```

2. **`Quaternion` (结构体)**：表示三维空间中的旋转（姿态）。
   
   C#
   
   ```
   public struct Quaternion
   {
      public double W { get; set; } // 标量部分
      public double X { get; set; } // 向量部分
      public double Y { get; set; }
      public double Z { get; set; }
   
      public Quaternion(double w, double x, double y, double z)
      {
          W = w;
          X = x;
          Y = y;
          Z = z;
      }
      // 可以添加常见的四元数运算，例如乘法、归一化、转换为欧拉角/旋转矩阵等
   }
   ```

3. **`Pose` (结构体)**：结合了位置和姿态，表示一个完整的空间位姿。
   
   C#
   
   ```
   public struct Pose
   {
      public Vector3D Position { get; set; }
      public Quaternion Orientation { get; set; }
   
      public Pose(Vector3D position, Quaternion orientation)
      {
          Position = position;
          Orientation = orientation;
      }
   }
   ```

### 核心业务数据结构

1. **`ProjectFile` (类)**：工程文件的根对象，包含所有项目数据，并支持版本控制。
   
   C#
   
   ```
   public class ProjectFile
   {
      public int Version { get; set; } = 1; // 用于数据迁移和兼容性
      public string ProjectName { get; set; }
      public string Description { get; set; }
      public DateTime CreationTime { get; set; }
      public DateTime LastModifiedTime { get; set; }
   
      public WorkpieceModel Workpiece { get; set; } // 工件模型数据
      public List<PathSequence> PathSequences { get; set; } = new List<PathSequence>(); // 路径序列
      public RobotConfiguration RobotConfig { get; set; } // 机械臂配置
      public GlobalSettings Settings { get; set; } // 全局设置，例如单位、精度等
      // 其他可能全局性的配置或引用
   }
   ```

2. **`WorkpieceModel` (类)**：代表导入的三维工件模型。
   
   C#
   
   ```
   public class WorkpieceModel
   {
      public string ModelId { get; set; } // 模型的唯一标识
      public string Name { get; set; }
      public string FilePath { get; set; } // 原始模型文件路径
      public string FileFormat { get; set; } // 例如 "STEP", "STL"
      public Pose Offset { get; set; } // 工件相对于机械臂基坐标系的偏移坐标
      public BoundingBox BoundingBox { get; set; } // 模型的包围盒，用于碰撞检测或显示优化
   
      // 内部几何数据（例如，如果需要保存模型的三角网格，可以封装在此）
      // public List<Triangle> MeshData { get; set; }
   }
   ```

3. **`PathSequence` (类)**：代表一个完整的路径序列，包含多个路径段。
   
   C#
   
   ```
   public class PathSequence
   {
      public string Id { get; set; } // 序列唯一标识
      public string Name { get; set; } // 路径序列名称
      public bool IsVisible { get; set; } = true; // 是否在3D视图中可见
      public List<PathSegment> Segments { get; set; } = new List<PathSegment>(); // 包含的路径段
      public PathParameters DefaultParameters { get; set; } // 适用于整个序列的默认参数
      public PathTransitionType TransitionType { get; set; } // 序列内部路径段之间的默认过渡方式
   }
   ```

4. **`PathSegment` (类)**：代表路径中的一个独立段落，可以是点、直线、曲线或贴地线。
   
   C#
   
   ```
   public class PathSegment
   {
      public string Id { get; set; } // 段的唯一标识
      public string Name { get; set; }
      public PathSegmentType Type { get; set; } // 路径段类型 (Point, Line, Spline, FollowSurface)
      public List<PathPoint> Points { get; set; } = new List<PathPoint>(); // 构成路径的离散点序列
      public PathParameters Parameters { get; set; } // 当前路径段的运动参数
      public IOConfiguration IOConfig { get; set; } // IO及通讯配置
      public RetractApproachSetting RetractApproach { get; set; } // 避让设定
      // 可能需要针对不同类型路径段的特有属性，例如：
      // public string SurfaceId { get; set; } // 如果是贴地线，关联的表面ID
      // public List<Vector3D> ControlPoints { get; set; } // 如果是曲线，控制点
   }
   
   public enum PathSegmentType
   {
      Point,
      Line,
      Spline,
      FollowSurface
   }
   ```

5. **`PathPoint` (类)**：代表路径上的一个离散点，包含位置和姿态。
   
   C#
   
   ```
   public class PathPoint
   {
      public string Id { get; set; } // 点的唯一标识
      public Pose Pose { get; set; } // 点的空间位姿
      public string Description { get; set; } // 可选描述
      // 可以添加点特定的IO、速度等覆盖参数，如果需要更细粒度的控制
   }
   ```

6. **`PathParameters` (类)**：定义路径的运动特性。
   
   C#
   
   ```
   public class PathParameters
   {
      public double Speed { get; set; } // 速度 (mm/s 或 deg/s)
      public double PointDensity { get; set; } // 走点密度 (每毫米的点数或角度步长)
      public ReferenceFrameType ReferenceFrame { get; set; } // 参考坐标系类型（例如，工具坐标系、工件坐标系、基坐标系）
      // 其他可能的运动参数，如加速度、平滑半径等
   }
   
   public enum ReferenceFrameType
   {
      Base,
      Workpiece,
      Tool
   }
   ```

7. **`IOConfiguration` (类)**：定义路径段开始和结束时的IO和通讯事件。
   
   C#
   
   ```
   public class IOConfiguration
   {
      public List<IOEvent> StartEvents { get; set; } = new List<IOEvent>();
      public List<IOEvent> EndEvents { get; set; } = new List<IOEvent>();
      // 可以扩展为更复杂的通讯配置，例如TCP/IP消息、Modbus寄存器读写等
   }
   
   public class IOEvent
   {
      public IOType Type { get; set; } // 例如 DigitalOutput, DigitalInput, AnalogOutput
      public string TagName { get; set; } // IO点位名称或地址
      public string Value { get; set; } // 期望值（例如 "True", "False", "10.5"）
      public int DelayMs { get; set; } // 延时执行 (毫秒)
      public string Description { get; set; }
   }
   
   public enum IOType
   {
      DigitalOutput,
      DigitalInput,
      AnalogOutput,
      TcpCommand,
      ModbusWrite
      // ... 其他通讯类型
   }
   ```

8. **`RetractApproachSetting` (类)**：定义避让策略。
   
   C#
   
   ```
   public class RetractApproachSetting
   {
      public RetractApproachStrategy Strategy { get; set; } // 避让策略类型
      public double RetractHeight { get; set; } // 抬起高度 (mm)
      public double ApproachHeight { get; set; } // 靠近高度 (mm)
      // 其他与避让相关的参数，例如方向、速度比例等
   }
   
   public enum RetractApproachStrategy
   {
      None,
      LinearAbovePoint,
      NormalToSurface
      // ... 其他策略
   }
   
   public enum PathTransitionType
   {
      None, // 不过渡，急停
      Smooth, // 平滑过渡
      Cornering, // 圆角过渡
      // ...
   }
   ```

9. **`RobotConfiguration` (类)**：机械臂配置数据。
   
   C#
   
   ```
   public class RobotConfiguration
   {
      public string RobotBrand { get; set; } // 品牌，例如 "Universal Robots", "ABB", "KUKA"
      public string RobotModel { get; set; } // 型号，例如 "UR5e", "IRB 120"
      public string SerialNumber { get; set; } // 序列号
      public List<Joint> Joints { get; set; } = new List<Joint>(); // 关节定义
      public ToolDefinition Tool { get; set; } // 工具定义
      public List<ReferencePlane> UserFrames { get; set; } = new List<ReferencePlane>(); // 用户自定义坐标系
      public string PostProcessorName { get; set; } // 关联的后处理器插件名称
      public string CommunicationProtocol { get; set; } // 关联的通讯协议类型/插件名称
      // 可能包含机器人基座的物理位置等
   }
   
   public class Joint
   {
      public string Name { get; set; } // 关节名称，例如 "Base", "Shoulder", "Elbow"
      public JointType Type { get; set; } // 关节类型 (Revolute, Prismatic)
      public double MinLimit { get; set; } // 最小关节限位
      public double MaxLimit { get; set; } // 最大关节限位
      // 其他关节参数，如物理长度、D-H参数等
   }
   
   public enum JointType
   {
      Revolute, // 旋转关节
      Prismatic // 移动关节
   }
   
   public class ToolDefinition
   {
      public string ToolName { get; set; }
      public Pose ToolCenterPointOffset { get; set; } // 工具末端点 (TCP) 相对于工具法兰的偏移
      public double ToolWeight { get; set; } // 工具重量
      public Vector3D CenterOfMassOffset { get; set; } // 工具重心相对于工具法兰的偏移
      // 其他与工具相关的定义，例如工具模型文件路径
   }
   
   public class ReferencePlane
   {
      public string Name { get; set; }
      public Pose Origin { get; set; } // 坐标系原点位姿
      // 可以是用户坐标系、工具坐标系等
   }
   ```

### 其他辅助结构

- **`BoundingBox` (结构体)**：定义一个轴对齐的包围盒。
  
  C#
  
  ```
  public struct BoundingBox
  {
      public Vector3D Min { get; set; }
      public Vector3D Max { get; set; }
  
      public BoundingBox(Vector3D min, Vector3D max)
      {
          Min = min;
          Max = max;
      }
  }
  ```

### 序列化建议

- **JSON 序列化：** 在 .NET 8 中，推荐使用 `System.Text.Json` 命名空间。它提供了高性能和灵活的序列化能力。
  
  - 对于 `ProjectFile` 这样的根对象，可以直接使用 `JsonSerializer.Serialize` 和 `JsonSerializer.Deserialize`。
  
  - 可以利用 `[JsonPropertyName("name")]` 属性来控制 JSON 字段的名称，与 C# 属性名解耦。
  
  - 对于枚举类型，默认会序列化为整数，可以使用 `JsonStringEnumConverter` 将其序列化为字符串，提高可读性。

- **版本兼容性：**
  
  - 加载时：当 `ProjectFile.Version` 与当前软件版本不一致时，触发数据迁移逻辑。这通常涉及一个或多个转换器类，负责将旧版本数据结构映射到新版本。
  
  - 保存时：始终保存为当前软件版本的数据结构。

这个初步的设计包含了大部分在需求文档中提到的核心数据项。您可以根据具体的开发细节和更深层次的需求来细化、增删或调整这些结构。例如，`PathSegment` 的 `Points` 列表可能不足以完全描述复杂的曲线或贴地线，可能需要更具体的几何描述对象。
