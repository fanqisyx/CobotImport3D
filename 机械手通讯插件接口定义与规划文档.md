### **机械手通讯插件接口定义与规划文档**

#### **1. 核心接口：`IRobotCommunicationPlugin`**

此接口定义了所有机械手通讯插件必须实现的功能，以确保核心平台能够以统一的方式与不同品牌的机械臂进行交互。

C#

```
namespace CorePlatform.Robotics
{
    // 定义机械臂连接状态
    public enum RobotConnectionStatus
    {
        Disconnected,   // 已断开连接
        Connecting,     // 正在连接
        Connected,      // 已连接
        Error           // 连接错误
    }

    // 定义机械臂运动状态
    public enum RobotMoveStatus
    {
        Stopped,    // 已停止
        Moving,     // 正在运动
        Paused      // 已暂停
    }

    // 定义机械臂控制模式
    public enum RobotControlMode
    {
        Manual,     // 手动模式
        Automatic   // 自动模式
    }

    /// <summary>
    /// 机械手通讯插件接口。所有机械臂品牌插件必须实现此接口。
    /// </summary>
    public interface IRobotCommunicationPlugin : IPlugin // 继承通用的 IPlugin 接口
    {
        /// <summary>
        /// 获取插件支持的机械臂品牌名称（例如："长广溪", "Universal Robots"）。
        /// </summary>
        string SupportedRobotBrand { get; }

        /// <summary>
        /// 获取当前机械臂的连接状态。
        /// </summary>
        RobotConnectionStatus ConnectionStatus { get; }

        /// <summary>
        /// 获取当前机械臂的运动状态。
        /// </summary>
        RobotMoveStatus MoveStatus { get; }

        /// <summary>
        /// 连接到指定的机械臂控制器。
        /// </summary>
        /// <param name="ipAddress">机械臂控制器的IP地址。</param>
        /// <param name="port">通讯端口。</param>
        /// <param name="password">连接密码（如果需要）。</param>
        /// <returns>连接成功返回 true，否则返回 false。</returns>
        Task<bool> Connect(string ipAddress, int port, string password = "");

        /// <summary>
        /// 断开与机械臂的连接。
        /// </summary>
        void Disconnect();

        /// <summary>
        /// 命令机械臂上电。
        /// </summary>
        Task<bool> PowerOn();

        /// <summary>
        /// 命令机械臂断电。
        /// </summary>
        Task<bool> PowerOff();

        /// <summary>
        /// 命令机械臂使能。
        /// </summary>
        Task<bool> Enable();

        /// <summary>
        /// 命令机械臂关使能。
        /// </summary>
        Task<bool> Disable();

        /// <summary>
        /// 命令机械臂故障复位。
        /// </summary>
        Task<bool> FaultReset();

        /// <summary>
        /// 获取机械臂当前的控制模式（手动/自动）。
        /// </summary>
        /// <returns>当前控制模式。</returns>
        Task<RobotControlMode> GetControlMode();

        /// <summary>
        /// 设置机械臂的整体运行速度百分比。
        /// </summary>
        /// <param name="speedPercent">速度百分比（范围：1-100）。</param>
        Task<bool> SetRobotSpeedPercent(uint speedPercent);

        /// <summary>
        /// 获取机械臂的整体运行速度百分比。
        /// </summary>
        /// <returns>当前速度百分比。</returns>
        Task<uint> GetRobotSpeedPercent();

        /// <summary>
        /// 获取机械臂的实时状态数据，包含位姿、关节位置、速度等详细信息。
        /// </summary>
        /// <returns>包含机器人当前状态的 RobotStateData 对象。</returns>
        Task<RobotStateData> GetRobotStateData(); // 这是一个关键的复杂数据结构

        /// <summary>
        /// 机器人轴空间运动到指定关节位置。
        /// </summary>
        /// <param name="jointAngles">目标关节角度数组。</param>
        /// <param name="isBlocking">是否阻塞当前调用直到运动完成。</param>
        /// <returns>运动指令发送成功返回 true，否则返回 false。</returns>
        Task<bool> MoveJoint(double[] jointAngles, bool isBlocking = true);

        /// <summary>
        /// 机器人末端直线运动到指定笛卡尔位姿。
        /// </summary>
        /// <param name="targetPose">目标笛卡尔位姿数组（例如：[X, Y, Z, Rx, Ry, Rz] 或 [X, Y, Z, Qw, Qx, Qy, Qz]）。</param>
        /// <param name="isBlocking">是否阻塞当前调用直到运动完成。</param>
        /// <returns>运动指令发送成功返回 true，否则返回 false。</returns>
        Task<bool> MoveLinear(double[] targetPose, bool isBlocking = true);

        /// <summary>
        /// 机器人末端圆弧运动到指定位姿。
        /// </summary>
        /// <param name="intermediatePose">圆弧上的中间点位姿数组。</param>
        /// <param name="endPose">圆弧的终点位姿数组。</param>
        /// <param name="isBlocking">是否阻塞当前调用直到运动完成。</param>
        /// <returns>运动指令发送成功返回 true，否则返回 false。</returns>
        Task<bool> MoveCircle(double[] intermediatePose, double[] endPose, bool isBlocking = true);

        /// <summary>
        /// 停止当前正在执行的运动。
        /// </summary>
        Task<bool> StopMove();

        /// <summary>
        /// 暂停当前正在执行的运动。
        /// </summary>
        Task<bool> PauseMove();

        /// <summary>
        /// 运行已下载到机械臂控制器的程序。
        /// </summary>
        Task<bool> PlayProgram();

        /// <summary>
        /// 获取机械臂末端执行器 (TCP) 的实际笛卡尔位姿。
        /// </summary>
        /// <returns>TCP 实际位姿数组。</returns>
        Task<double[]> GetActualTcpPose();

        /// <summary>
        /// 获取机械臂各关节的实际位置（角度或位移）。
        /// </summary>
        /// <returns>关节实际位置数组。</returns>
        Task<double[]> GetActualJointPositions();

        /// <summary>
        /// 执行正运动学计算：从关节位置计算末端执行器 (TCP) 的笛卡尔位姿。
        /// </summary>
        /// <param name="jointAngles">输入关节角度数组。</param>
        /// <returns>计算出的 TCP 笛卡尔位姿数组。</returns>
        Task<double[]> ForwardKinematics(double[] jointAngles);

        /// <summary>
        /// 执行逆运动学计算：从末端执行器 (TCP) 的笛卡尔位姿计算对应的关节位置。
        /// </summary>
        /// <param name="targetPose">目标 TCP 笛卡尔位姿数组。</param>
        /// <param name="currentJoints">当前关节位置数组，用于解算逆解的歧义性（可选）。</param>
        /// <returns>计算出的关节位置数组。</returns>
        Task<double[]> InverseKinematics(double[] targetPose, double[] currentJoints = null);

        /// <summary>
        /// 读取指定索引的数字量输入状态。
        /// </summary>
        /// <param name="index">数字量输入点索引。</param>
        /// <returns>数字量输入状态（例如：0 或 1）。</returns>
        Task<int> GetDigitalInput(int index);

        /// <summary>
        /// 设置指定索引的数字量输出状态。
        /// </summary>
        /// <param name="index">数字量输出点索引。</param>
        /// <param name="value">要设置的值（例如：0 或 1）。</param>
        /// <returns>设置成功返回 true，否则返回 false。</returns>
        Task<bool> SetDigitalOutput(int index, int value);

        /// <summary>
        /// 读取指定索引的模拟量输入值。
        /// </summary>
        /// <param name="index">模拟量输入点索引。</param>
        /// <returns>模拟量输入值。</returns>
        Task<double> GetAnalogInput(int index);

        /// <summary>
        /// 设置指定索引的模拟量输出值。
        /// </summary>
        /// <param name="index">模拟量输出点索引。</param>
        /// <param name="value">要设置的值。</param>
        /// <returns>设置成功返回 true，否则返回 false。</returns>
        Task<bool> SetAnalogOutput(int index, double value);

        /// <summary>
        /// 当机械臂连接状态发生变化时触发。
        /// </summary>
        event EventHandler<RobotConnectionStatus> ConnectionStatusChanged;

        /// <summary>
        /// 当机械臂运动状态发生变化时触发。
        /// </summary>
        event EventHandler<RobotMoveStatus> MoveStatusChanged;

        /// <summary>
        /// 当机械臂实时状态数据更新时触发。
        /// </summary>
        event EventHandler<RobotStateData> RobotStateDataUpdated;

        /// <summary>
        /// 当机械臂发生报警或错误时触发。
        /// </summary>
        event EventHandler<string> RobotAlarmOccurred;
    }
}
```

#### **2. 关键数据结构：`RobotStateData`**

为了封装机械臂的各种实时状态信息，供上层应用和仿真可视化使用，我们定义 `RobotStateData` 类。其具体属性将根据“长广溪”SDK 中 `RobotStateData` 的定义以及其他相关 `Get` API 的返回内容进行细化。

C#

```
namespace CorePlatform.Robotics
{
    /// <summary>
    /// 封装机械臂的实时状态数据。
    /// </summary>
    public class RobotStateData
    {
        // TCP 位姿和速度信息
        public double[] ActualTcpPose { get; set; } // 实际TCP位姿 (X, Y, Z, Rx, Ry, Rz / Qw, Qx, Qy, Qz)
        public double[] TargetTcpPose { get; set; } // 目标TCP位姿
        public double[] ActualTcpSpeed { get; set; } // 实际TCP速度
        public double[] TargetTcpSpeed { get; set; } // 目标TCP速度
        public double[] ActualTcpAcceleration { get; set; } // 实际TCP加速度
        public double[] TargetTcpAcceleration { get; set; } // 目标TCP加速度

        // 关节位置、速度、电流、转矩、电压、温度信息
        public double[] ActualJointPositions { get; set; } // 实际关节位置
        public double[] TargetJointPositions { get; set; } // 目标关节位置
        public double[] ActualJointVelocities { get; set; } // 实际关节速度
        public double[] TargetJointVelocities { get; set; } // 目标关节速度
        public double[] ActualJointCurrents { get; set; } // 实际关节电机电流
        public double[] TargetJointCurrents { get; set; } // 目标关节电机电流
        public double[] ActualJointTorques { get; set; } // 实际关节转矩
        public double[] ActualJointVoltages { get; set; } // 实际关节采集的母线电压
        public double[] JointTemperatures { get; set; } // 关节温度
        // public JointModes[] JointModes { get; set; } // 关节模式，需要根据SDK定义 JointModes 枚举

        // 机器人整体状态
        public RobotMoveStatus MoveStatus { get; set; } // 机械臂运动状态
        public RobotConnectionStatus ConnectionStatus { get; set; } // 机械臂连接状态
        public RobotControlMode ControlMode { get; set; } // 机械臂控制模式
        public uint CurrentSpeedPercent { get; set; } // 当前速度百分比

        // IO 状态（可以根据需要进一步细化为列表或字典）
        public int[] ControllerDigitalInputs { get; set; } // 控制柜数字输入
        public int[] ControllerDigitalOutputs { get; set; } // 控制柜数字输出
        public double[] ControllerAnalogInputs { get; set; } // 控制柜模拟输入
        public double[] ControllerAnalogOutputs { get; set; } // 控制柜模拟输出
        public int[] ToolDigitalInputs { get; set; } // 工具端数字输入
        public int[] ToolDigitalOutputs { get; set; } // 工具端数字输出
        public double[] ToolAnalogInputs { get; set; } // 工具端模拟输入
        public double[] ToolAnalogOutputs { get; set; } // 工具端模拟输出

        // 其他来自 SDK 的状态信息，例如：
        // public bool HasScriptPopup { get; set; } // 是否存在弹窗
        // public string ScriptPopupMessage { get; set; } // 弹窗信息
        // public int CurrentScriptLine { get; set; } // 脚本当前运行行号
        // public string RobotMode { get; set; } // 机械臂当前模式 (例如：空闲，运行，报警)
    }
}
```

#### **3. 接口实现者：`ChangguangxiRobotPlugin`**

“长广溪”机械臂的通讯插件（`ChangguangxiRobotPlugin`）将实现上述 `IRobotCommunicationPlugin` 接口。在其方法内部，它将负责调用“长广溪”C# SDK 提供的具体 API（例如 `cr_create_robot`, `cr_moveJ`, `cr_get_robotStateData` 等），并将 SDK 特有的数据类型（如 `PointControlPara`, `TCPMsg`, `PayLoad` 等）与 `IRobotCommunicationPlugin` 定义的通用类型进行转换。

---

这份文档定义了机械手通讯插件的核心接口和关键数据结构。它为我们与“长广溪”机械臂的集成提供了明确的指导，并确保了未来扩展支持其他品牌机械臂的灵活性。
